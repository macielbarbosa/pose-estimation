<html>
  <head>
    <!-- Load TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <!-- Load Posenet -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/posenet"></script>
 </head>
  <!-- Place your code in the script tag below. You can also use an external .js file -->
  <script>
    var net

    const createImage = src => new Promise((resolve, reject) => {
      const image = new Image()
      image.onload = () => resolve(image)
      image.onerror = reject
      image.src = src
    })

    const estimate = async (imageUrl) => {
      const image = await createImage(imageUrl)
      const estimation = await net.estimateMultiplePoses(image, {
        flipHorizontal: false,
        maxDetections: 2,
        scoreThreshold: 0.6,
        nmsRadius: 20
      })
      const coordinates = []
      estimation[0].keypoints.forEach(({position}) => {
        const {x, y} = position
        coordinates.push(x, y)
      })
      return coordinates
    }

    const header = [
      "nose_x",
      "nose_y",
      "leftEye_x",
      "leftEye_y",
      "rightEye_x",
      "rightEye_y",
      "leftEar_x",
      "leftEar_y",
      "rightEar_x",
      "rightEar_y",
      "leftShoulder_x",
      "leftShoulder_y",
      "rightShoulder_x",
      "rightShoulder_y",
      "leftElbow_x",
      "leftElbow_y",
      "rightElbow_x",
      "rightElbow_y",
      "leftWrist_x",
      "leftWrist_y",
      "rightWrist_x",
      "rightWrist_y",
      "leftHip_x",
      "leftHip_y",
      "rightHip_x",
      "rightHip_y",
      "leftKnee_x",
      "leftKnee_y",
      "rightKnee_x",
      "rightKnee_y",
      "leftAnkle_x",
      "leftAnkle_y",
      "rightAnkle_x",
      "rightAnkle_y",
    ]

    const initService = async () => {
      net = await posenet.load()
      const coordinates = await estimate('imagens/em-pe.jpg')
      console.log({header, coordinates})
    }

    initService()
  </script>
</html>